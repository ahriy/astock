# A股基本面分析器 - 产品说明书 (PRD)

**版本**: v1.0  
**日期**: 2026-02-27  
**状态**: 已完成第一版迭代

---

## 1. 产品概述

### 1.1 产品定位
A股价值投资分析工具，基于Tushare Pro API，自动抓取A股全量基本面数据，计算财务指标和价值评分，生成投资分析报告。

### 1.2 目标用户
- 价值投资者
- 基本面分析研究者
- 量化投资初学者

### 1.3 核心价值
- **数据精简**: 从日线级(750条/股)降至年报级(3条/股)，数据量减少99.6%
- **断点保护**: 支持中断恢复，适合长时间批量分析
- **价值评分**: 基于PE/PB/股息率等多维度自动评分(A+-D级)

---

## 2. 功能规格

### 2.1 数据获取模块 (data_fetcher.py)

| 功能 | 状态 | 说明 |
|------|------|------|
| 股票列表获取 | ✅ | 获取全部A股基础信息 |
| 年度财务数据 | ✅ | fina_indicator接口，每年1条年报数据 |
| 年度估值数据 | ✅ | daily_basic接口，每年4月30日附近数据 |
| 数据合并 | ✅ | 财务指标+估值指标合并输出 |
| 数据缓存 | ✅ | 本地缓存，避免重复请求 |
| 频率控制 | ✅ | API调用间隔控制，避免触发限制 |
| 重试机制 | ✅ | 失败自动重试5次 |

**数据字段输出**:
```
基础信息: ts_code, name, industry, area, list_date
财务指标: eps, roe, roa, grossprofit_margin, debt_to_assets...
估值指标: pe, pe_ttm, pb, ps, dv_ratio, total_mv...
```

### 2.2 数据验证模块 (data_validator.py)

| 功能 | 状态 | 说明 |
|------|------|------|
| 股票列表验证 | ✅ | 检查必要字段完整性 |
| 年度数据验证 | ✅ | 检查年份数量、字段完整性 |
| 异常值检测 | ✅ | IQR方法检测PE/PB异常值 |
| 数据清洗 | ✅ | 处理缺失值、极端值 |
| 完整性报告 | ✅ | 统计完整/不完整/缺失数据 |

### 2.3 分析模块 (analyzer.py)

| 功能 | 状态 | 说明 |
|------|------|------|
| 单股分析 | ✅ | 计算3年均值、中位数、标准差 |
| 年度统计 | ✅ | 按年统计PE/PB/股息率 |
| 趋势分析 | ✅ | 线性回归判断上升/下降/稳定 |
| 价值评分 | ✅ | 估值(40分)+股息(30分)+稳定性(30分) |
| 评级输出 | ✅ | A+(80-100)/A(70-79)/B(60-69)/C(40-59)/D(0-39) |

**评分标准**:
```
估值评分(40分):
  PE<10: 20分 | PE<15: 15分 | PE<20: 10分 | PE<30: 5分
  PB<1: 20分 | PB<1.5: 15分 | PB<2: 10分 | PB<3: 5分

股息评分(30分):
  股息率>5%: 30分 | >4%: 25分 | >3%: 20分 | >2%: 15分 | >1%: 10分

稳定性评分(30分):
  PE变异系数<0.1: 30分 | <0.2: 20分 | <0.3: 10分
```

### 2.4 导出模块 (exporter.py)

| 功能 | 状态 | 说明 |
|------|------|------|
| Excel导出 | ✅ | 固定文件名a_stock_analysis.xlsx |
| CSV导出 | ✅ | 固定文件名a_stock_analysis.csv |
| 综合报告 | ✅ | 多工作表Excel，含汇总统计 |
| 文本报告 | ✅ | summary_report.txt |

### 2.5 主程序模块 (main.py)

| 功能 | 状态 | 说明 |
|------|------|------|
| 断点续传 | ✅ | 每100只自动保存，支持中断恢复 |
| 年度数据模式 | ✅ | 默认模式，获取年报数据 |
| 日线数据模式 | ✅ | --daily参数切换 |
| 抽样测试 | ✅ | --sample N，测试N只股票 |
| 进度显示 | ✅ | 实时显示处理进度 |
| 信号处理 | ✅ | Ctrl+C安全退出 |

---

## 3. 数据规格

### 3.1 输入数据

| 数据源 | 接口 | 频率 | 积分要求 |
|--------|------|------|----------|
| 股票基础信息 | stock_basic | 一次性 | 免费 |
| 财务指标 | fina_indicator | 年报 | 2000+积分 |
| 每日指标 | daily_basic | 每年1次 | 2000+积分 |

### 3.2 输出数据

**主分析表字段**:
```
股票代码, 股票名称, 所属行业, 所在地域
最新PE, 最新PB, 最新股息率
PE_3年均值, PB_3年均值, 股息率_3年均值
PE_3年中位数, PB_3年中位数, 股息率_3年中位数
2023年PE, 2023年PB, 2023年股息率
2024年PE, 2024年PB, 2024年股息率
2025年PE, 2025年PB, 2025年股息率
PE趋势, PB趋势, 股息率趋势
价值评分, 评级, 投资建议
```

### 3.3 数据量对比

| 模式 | 每只股票 | 5000只总量 | 运行时间 |
|------|---------|-----------|---------|
| 旧版(日线) | 750条 | 375万条 | 2-3小时 |
| 新版(年报) | 3条 | 1.5万条 | 约10分钟 |

---

## 4. 使用指南

### 4.1 安装

```bash
pip install tushare pandas numpy openpyxl
```

### 4.2 配置

编辑 `src/config.py`:
```python
TUSHARE_TOKEN = "你的API Token"
ANALYSIS_YEARS = 3  # 分析年限
```

### 4.3 运行

```bash
cd src

# 完整分析(全部A股)
python main.py

# 抽样测试(100只)
python main.py --sample 100

# 使用日线数据模式
python main.py --daily

# 重新开始(忽略断点)
python main.py --restart

# 查看进度
python main.py --progress
```

### 4.4 查看结果

输出目录 `output/`:
- `a_stock_analysis.xlsx` - 主分析结果
- `comprehensive_report.xlsx` - 综合报告
- `summary_report.txt` - 文本汇总
- `failed_stocks.csv` - 失败股票列表
- `incomplete_stocks.csv` - 不完整数据股票

---

## 5. 版本历史

### v1.0 (2026-02-27)
**已完成**:
- ✅ 数据获取从日线改为年度财务指标
- ✅ 断点续传机制适配新模式
- ✅ 年度数据验证和完整性检查
- ✅ 价值评分和评级系统
- ✅ 多格式导出(Excel/CSV/文本)

**已知问题**:
- 部分股票2022年数据有重复
- 某些日期无数据时自动找附近交易日(可能不够精确)

---

## 6. 路线图

### v1.1 (计划中)
- [ ] 修复数据重复问题
- [ ] 优化日期匹配逻辑(精确到交易日)
- [ ] 增加更多财务指标(ROE趋势、营收增长等)
- [ ] 添加行业对比功能

### v1.2 (计划中)
- [ ] 数据可视化(评分分布图、行业对比图)
- [ ] 增加筛选器(按行业/市值/评分筛选)
- [ ] 历史回测功能

### v2.0 (规划中)
- [ ] Web界面
- [ ] 实时数据更新
- [ ] 自定义评分模型

---

## 7. 附录

### 7.1 依赖清单
```
tushare>=1.2.0
pandas>=1.3.0
numpy>=1.21.0
openpyxl>=3.0.0
```

### 7.2 文件结构
```
a_stock_analyzer/
├── src/
│   ├── config.py          # 配置
│   ├── main.py            # 主程序
│   ├── data_fetcher.py    # 数据获取
│   ├── data_validator.py  # 数据验证
│   ├── analyzer.py        # 分析引擎
│   └── exporter.py        # 导出模块
├── data/                  # 缓存数据
├── output/                # 分析结果
├── logs/                  # 日志文件
├── requirements.txt       # 依赖
└── README.md             # 使用说明
```

### 7.3 联系方式
- 问题反馈: [待填写]
- 功能建议: [待填写]

---

**文档维护**: 产品经理  
**最后更新**: 2026-02-27
